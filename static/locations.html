<!DOCTYPE html>
<html lang="en">
<head>
  <link id="favicon" rel="icon" type="image/x-icon" href="/static/favicon/favicon.ico">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Browse climbing locations with maps, approach info, and albums from each location." />
  <title>Locations</title>
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#bb86fc">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Climbing">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    /* Page scaffold */
    .locations-page { padding: 1rem; }
    .locations-header { display: flex; gap: 0.75rem; align-items: center; margin: 0.5rem 0 1rem; justify-content: space-between; }
    .locations-count { color: #aaa; font-size: 0.95rem; }

    /* Search FAB */
    .search-fab {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 56px; height: 56px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #bb86fc 0%, #7c4dff 100%);
      box-shadow: 0 6px 20px rgba(187, 134, 252, 0.4);
      display: inline-flex; align-items: center; justify-content: center;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      z-index: 1000;
    }
    .search-fab:hover { transform: scale(1.08); box-shadow: 0 8px 30px rgba(187, 134, 252, 0.6); }
    .search-fab:active { transform: scale(0.95); }
    .search-fab.active { background: linear-gradient(135deg, #03dac6 0%, #018786 100%); }
    .search-fab-icon { font-size: 1.5rem; color: #fff; }

    /* Search Popup */
    .search-popup-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.4);
      pointer-events: none; opacity: 0; transition: opacity 0.2s ease; z-index: 999;
    }
    .search-popup-overlay.active { pointer-events: auto; opacity: 1; }
    .search-popup {
      position: fixed; bottom: 6rem; right: 2rem; width: min(480px, 92vw);
      background: rgba(18,18,18,0.92);
      border-radius: 16px; border: 1px solid #333;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      transform: translateY(12px) scale(0.98); opacity: 0; visibility: hidden;
      transition: all 0.22s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1001;
    }
    .search-popup.active { transform: translateY(0) scale(1); opacity: 1; visibility: visible; }
    .search-popup-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.2rem; border-bottom: 1px solid #333; }
    .search-popup-title { font-size: 1.1rem; font-weight: 700; color: #fff; }
    .search-popup-close { background: none; border: none; color: #bbb; font-size: 1.2rem; cursor: pointer; border-radius: 8px; padding: 0.25rem 0.5rem; }
    .search-popup-close:hover { background: #333; color: #fff; }
    .search-popup-content { padding: 1rem 1.2rem; }
    .search-input { width: 100%; padding: 0.85rem 1rem; border-radius: 12px; border: 2px solid #333; background: #222; color: #fff; }
    .search-popup-footer { padding: 0.75rem 1.2rem 1.1rem; display: flex; gap: 0.6rem; justify-content: flex-end; }
    .search-action-btn { background: linear-gradient(135deg, #333 0%, #444 100%); border: 1px solid #555; color: #e0e0e0; padding: 0.6rem 0.9rem; border-radius: 10px; cursor: pointer; }
    .search-action-btn:hover { border-color: #bb86fc; }

    /* Location section */
    .location-section { border: 1px solid #2f2f2f; border-radius: 16px; padding: 1rem; margin: 0 0 1rem; background: linear-gradient(135deg, #161616 0%, #1f1f1f 100%); }
    .location-section.selected { border-color: #bb86fc; box-shadow: 0 0 0 2px rgba(187,134,252,0.18) inset; }
    .location-header { display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
    .location-title { display: flex; gap: 0.5rem; align-items: center; color: #fff; font-weight: 700; flex: 1; min-width: 0; }
    .location-title input[type="text"] { max-width: 100%; width: min(100%, 26ch); box-sizing: border-box; }
    .location-title .pin { font-size: 1.2rem; }
    .location-actions { display: flex; gap: 0.5rem; flex: 0 0 auto; }
    .location-btn { background: #333; border: 1px solid #444; color: #ddd; padding: 0.4rem 0.7rem; border-radius: 10px; cursor: pointer; font-size: 0.75rem; }
    .location-btn:hover { border-color: #bb86fc; }
    /* Icon-only variant for nav apps */
    .icon-btn { width: 42px; height: 42px; padding: 0; display: inline-flex; align-items: center; justify-content: center; }
    .icon-btn svg { width: 22px; height: 22px; color: #ddd; }
    .icon-btn:hover svg { color: #bb86fc; }
    .icon-btn img { width: 22px; height: 22px; display: block; }

    /* Two-column responsive: map + details */
    .location-body { display: grid; grid-template-columns: 360px 1fr; gap: 0.5rem; align-items: start; }
    .location-map { position: relative; width: 100%; aspect-ratio: 4 / 3; border: 1px solid #333; border-radius: 12px; overflow: hidden; background: #111; }
    .location-map .map-viewport { width: 100%; height: 100%; pointer-events: none; touch-action: pan-y; }
    .map-activation-overlay {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
      background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.10)); cursor: pointer; z-index: 2;
      user-select: none; -webkit-user-select: none; touch-action: pan-y;
    }
    .map-activation-overlay .hint { color: #ccc; font-size: 0.9rem; background: rgba(0,0,0,0.35); padding: 0.25rem 0.5rem; border-radius: 8px; }
    .location-info { display: flex; flex-direction: column; gap: 0.5rem; min-width: 0; }
    .map-col { display: flex; flex-direction: column; }
    .coords-row { margin-top: 0.4rem; }
    .location-approach { background: #202020; border: 1px solid #333; border-radius: 12px; padding: 0.75rem; color: #ddd; line-height: 1.5; }
    .location-approach .heading { color: #aaa; font-weight: 600; font-size: 0.95rem; margin-bottom: 0.4rem; }

    /* Albums scroller */
    .albums-scroller {
      display: flex;
      gap: 0.6rem;
      width: 100%;
      overflow-x: auto;
      overflow-y: visible;
      padding-bottom: 0.25rem;
      /* Hide scrollbar (Firefox) */
      scrollbar-width: none;
      /* Hide scrollbar (IE/Edge legacy) */
      -ms-overflow-style: none;
      -webkit-overflow-scrolling: touch;
      touch-action: auto;
    }
    /* Hide scrollbar (WebKit) */
    .albums-scroller::-webkit-scrollbar { display: none; }
    .mini-album-card { flex: 0 0 auto; width: 180px; border-radius: 12px; border: 1px solid #333; background: #222; text-decoration: none; color: inherit; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .mini-album-card:hover { transform: translateY(-3px); box-shadow: 0 5px 5px rgba(0,0,0,0.35); }
    .mini-album-img { width: 100%; height: 220px; object-fit: cover; border-radius: 12px 12px 0 0; display: block; }
    .mini-album-content { padding: 0.5rem 0.6rem 0.6rem; }
    .mini-album-title { font-size: 0.95rem; font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .mini-album-sub { font-size: 0.8rem; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .section-divider { height: 1px; background: #2a2a2a; margin: 0.5rem 0; }

    @media (max-width: 900px) {
      .location-body { grid-template-columns: 1fr; }
    }

    /* Full-bleed album scroller on small screens */
    @media (max-width: 900px) {
      .albums-scroller {
        width: 100vw;
        margin-left: calc(50% - 50vw);
        margin-right: calc(50% - 50vw);
        /* Account for page (1rem) + section (1rem) padding so first card aligns */
        padding-left: 2rem;
        padding-right: 2rem;
      }
      /* If only one album card, don't full-bleed; keep inline with content */
      .albums-scroller.single {
        width: 100%;
        margin-left: 0;
        margin-right: 0;
        padding-left: 0;
        padding-right: 0;
      }
    }

    /* Desktop spacing: ensure margin between share icons row and approach panel
       when approach is moved under the map column */
    @media (min-width: 901px) {
      .map-col > .location-approach { margin-top: 0.6rem; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="/crew">Crew</a>
    <a href="/albums">Albums</a>
    <a href="/locations" class="active">Locations</a>
    <a href="/knowledge">Knowledge</a>
    <a href="/memes">Memes</a>
  </nav>
  <main class="page-fade locations-page">
    <div id="locations-header" class="locations-header">
      <div id="locations-count" class="locations-count"></div>
    </div>
    <div id="locations-container"></div>
  </main>

  <!-- Search FAB and Popup -->
  <button id="locations-search-fab" class="search-fab" title="Search locations">
    <span class="search-fab-icon">ðŸ”Ž</span>
  </button>
  <div id="locations-search-overlay" class="search-popup-overlay"></div>
  <div id="locations-search-popup" class="search-popup" role="dialog" aria-modal="true" aria-labelledby="locations-search-title">
    <div class="search-popup-header">
      <div id="locations-search-title" class="search-popup-title">Search Locations</div>
      <button id="locations-search-close" class="search-popup-close" aria-label="Close">Ã—</button>
    </div>
    <div class="search-popup-content">
      <input id="locations-filter" class="search-input" type="text" placeholder="Type to filter locations..." aria-label="Search locations">
    </div>
    <div class="search-popup-footer">
      <button id="locations-search-clear" class="search-action-btn">Clear</button>
      <button id="locations-search-done" class="search-action-btn">Done</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="/static/js/locations.js"></script>
  <!-- PWA and Notification Management -->
  <script src="/static/js/pwa-manager.js"></script>
  <script src="/static/js/notification-health-manager.js"></script>
  <script src="/static/js/notifications.js"></script>
  <script src="/static/js/cache-manager.js"></script>
  <script src="/static/js/update-notifier.js"></script>
  <script src="/static/js/auth.js"></script>
  <a href="/privacy" class="privacy-link" title="Privacy Policy">
    <span class="privacy-link-icon">ðŸ”’</span>
    <span class="privacy-link-text">Privacy</span>
  </a>
</body>
</html>


